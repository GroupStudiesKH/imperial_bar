<script>
import { useRouter, useRoute } from "vue-router";
// mounted
import { onMounted, ref } from "vue";
import Header from "@/components/Header.vue";
import { useI18n } from "vue-i18n";
import Bootstrap from "bootstrap/dist/js/bootstrap.bundle";

export default {
  components: {
    Header,
  },
  setup() {
    const router = useRouter();
    const { t, locale } = useI18n();
    const shopData = ref([]);
    const route = useRoute();
    const shopID = route.params.id;
    const locationSelected = ref("北部");
    const styleSelected = ref("");

    const loadShopData = async () => {
      try {
        const response = await fetch("/data/bar.json"); // 載入 JSON 檔案
        if (!response.ok) {
          throw new Error("Network response was not ok");
        }
        let data = await response.json(); // 將 JSON 資料轉換為陣列
        shopData.value = data.filter(
          (item) => item.location == locationSelected.value
        );
        if (styleSelected.value != "") {
          shopData.value = shopData.value.filter(
            (item) => item.class == styleSelected.value
          );
        }

        console.log(shopData.value);
      } catch (error) {
        console.error("There was a problem with the fetch operation:", error);
      }
    };

    const changeLocation = (location) => {
      locationSelected.value = location;
      loadShopData();
    };

    const changeStyle = (style) => {
      styleSelected.value = style;
      loadShopData();
    };

    onMounted(() => {
      loadShopData();
    });

    return {
      t,
      locale,
      shopData,
      changeLocation,
      changeStyle,
      locationSelected,
      styleSelected,
    };
  },
};
</script>

<template>
  <Header />
  <main>
    <div
      id="banner_carousel"
      class="carousel slide"
      data-bs-ride="true"
      data-bs-touch="true"
    >
      <div class="carousel-indicators">
        <button
          type="button"
          data-bs-target="#banner_carousel"
          data-bs-slide-to="0"
          class="active"
          aria-current="true"
          aria-label="Slide 1"
        ></button>
        <button
          type="button"
          data-bs-target="#banner_carousel"
          data-bs-slide-to="1"
          aria-label="Slide 2"
        ></button>
        <button
          type="button"
          data-bs-target="#banner_carousel"
          data-bs-slide-to="2"
          aria-label="Slide 3"
        ></button>
      </div>
      <div class="carousel-inner">
        <div class="carousel-item active">
          <img src="/assets/img/banner.png" class="d-block w-100" alt="..." />
        </div>
        <div class="carousel-item">
          <img src="/assets/img/banner.png" class="d-block w-100" alt="..." />
        </div>
        <div class="carousel-item">
          <img src="/assets/img/banner.png" class="d-block w-100" alt="..." />
        </div>
      </div>
    </div>
    <div class="container" id="bars">
      <div class="row">
        <div class="col-12 px-5 discoveryBarTitle">
          <h4>探索酒吧</h4>
        </div>
      </div>

      <div class="row selectAreaStyle px-5">
        <div class="col-3">
          <h6>地點</h6>
        </div>
        <div class="col-9">
          <div
            class="pill"
            :class="locationSelected == `北部` ? `active` : ``"
            @click="changeLocation(`北部`)"
          >
            北部
          </div>
          <div
            class="pill"
            :class="locationSelected == `中部` ? `active` : ``"
            @click="changeLocation(`中部`)"
          >
            中部
          </div>
          <div
            class="pill"
            :class="locationSelected == `南部` ? `active` : ``"
            @click="changeLocation(`南部`)"
          >
            南部
          </div>
        </div>
      </div>

      <div class="row selectAreaStyle px-5">
        <div class="col-3">
          <h6>風格</h6>
        </div>
        <div class="col-9">
          <div
            class="pill"
            :class="styleSelected == `派對聚餐` ? `active` : ``"
            @click="changeStyle(`派對聚餐`)"
          >
            派對聚餐
          </div>
          <div
            class="pill"
            :class="styleSelected == `深夜酒吧` ? `active` : ``"
            @click="changeStyle(`深夜酒吧`)"
          >
            深夜酒吧
          </div>
          <div
            class="pill"
            :class="styleSelected == `晚餐小酌` ? `active` : ``"
            @click="changeStyle(`晚餐小酌`)"
          >
            晚餐小酌
          </div>
          <div
            class="pill"
            :class="styleSelected == `日式居酒屋` ? `active` : ``"
            @click="changeStyle(`日式居酒屋`)"
          >
            日式居酒屋
          </div>
          <div
            class="pill"
            :class="styleSelected == `特色店家` ? `active` : ``"
            @click="changeStyle(`特色店家`)"
          >
            特色店家
          </div>
        </div>
      </div>

      <div class="col-12">
        <div class="row">
          <div
            class="col-6 barColDiscovery"
            v-for="(shop, shopIndex) in shopData"
            :key="shopIndex"
          >
            <router-link :to="'/detail/' + shop.id">
              <div class="octagonBar">
                <div class="title">{{ shop.subtitle }}</div>
                <div
                  class="bar_img"
                  :style="`background-image: url('/assets/img/shop/${shop.id}-1.jpg')`"
                ></div>
                <div class="bar_title">
                  <h5>{{ shop.store_name }}</h5>
                </div>
                <div class="bar_address">
                  <p>📍{{ shop.store_address }}</p>
                </div>
              </div>
            </router-link>
          </div>
        </div>
      </div>
      <div id="page_bottom">
        <img src="/assets/img/previous.png" />
      </div>
    </div>
  </main>
</template>
